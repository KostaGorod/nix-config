apiVersion: v1
kind: Pod
metadata:
  name: probe-host-k3s-kubeconfig
spec:
  restartPolicy: Never
  containers:
    - name: probe
      image: ubuntu:22.04
      command: ["/bin/bash", "-c"]
      args:
        - |
          set -euo pipefail

          if [[ -e /host-k3s/k3s.yaml ]]; then
            mode=$(stat -c '%a' /host-k3s/k3s.yaml)
            echo "[probe] HOST_K3S_KUBECONFIG_PRESENT=yes"
            echo "[probe] HOST_K3S_KUBECONFIG_MODE=$mode"
          else
            echo "[probe] HOST_K3S_KUBECONFIG_PRESENT=no"
          fi
      volumeMounts:
        - name: host-k3s-kubeconfig
          mountPath: /host-k3s/k3s.yaml
          readOnly: true
  volumes:
    - name: host-k3s-kubeconfig
      hostPath:
        path: /etc/rancher/k3s/k3s.yaml
